<html>

<head>

<title>my_web_socket_test</title>

<script type="text/javascript" src="javascript/mootools.js"></script>
<script type="text/javascript">

	var echoSocket = new WebSocket("ws://localhost:9292",[]);

	echoSocket.onopen = function(e) {
		// Check the protocol chosen by the server
		console.log("Protocol: " + echoSocket.protocol);
		console.log("readyState: " + echoSocket.readyState);
	};

	echoSocket.onmessage = function(e) {
		var jsonString = e.data;
		console.log("Message:")
		console.log(JSON.stringify(JSON.parse(jsonString)));
	};

	window.addEvent("domready", function() {
		document.id("submit").addEvent('click', function() {
			echoSocket.send(document.id("input").get('value'));
		});

		document.id("submit_close").addEvent('click', function() {
			echoSocket.close(parseInt(document.id("close_code").value), document.id("close_reason").value);
		});

	});

	window.addEvent("unload", function() {
		console.log("unloading");
		echoSocket.close(1001);
	});

</script>

</head>

<body>

	<input id="input" type="text"></input>
	<input id="submit" type="submit"></input>
	<input id="close_code" type="text"></input>
	<input id="close_reason" type="text"></input>
	<input id="submit_close" type="submit"></input>

</body>

</html>
